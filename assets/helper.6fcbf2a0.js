import{ah as _,a as M,aW as F,b9 as b,m as f,h as t,ae as N,ci as Y,bP as re,S as w,aC as q,cn as Ge,co as Ve,b5 as D,bQ as $e,da as ye,C as y,ba as A,n as Z,az as E,a4 as W,d2 as je,dc as S,G as xe,dd as He,cl as ve,k as R,e as Ue,x as Ke,I as Qe,E as T,t as Xe,cr as qe,aL as ee,ca as _e,de as ke,cb as pe,ai as ne}from"./index.16943de2.js";import{P as Je}from"./Paginator.ea6c2428.js";var I;(function(e){e[e.Pending=0]="Pending",e[e.Running=1]="Running",e[e.Succeeded=2]="Succeeded",e[e.Canceling=3]="Canceling",e[e.Canceled=4]="Canceled",e[e.Errored=5]="Errored",e[e.Failing=6]="Failing",e[e.Failed=7]="Failed",e[e.WaitingRetry=8]="WaitingRetry",e[e.BeforeRetry=9]="BeforeRetry"})(I||(I={}));const Ye={[I.Failed]:"danger",[I.Succeeded]:"success",[I.Canceled]:"neutral"},Ze=e=>{if(e.role<0)return null;const n=["info","neutral","accent"];return t(ve,{get colorScheme(){return n[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})},Ee=e=>{const n=M();return t(ve,{get colorScheme(){var d;return(d=Ye[e.state])!=null?d:"info"},get children(){return n(`tasks.state.${e.state}`)}})},l=[{name:"name",textAlign:"left",w:_().role===2?"calc(100% - 660px)":"calc(100% - 560px)"},{name:"creator",textAlign:"center",w:_().role===2?"100px":"0"},{name:"state",textAlign:"center",w:"100px"},{name:"progress",textAlign:"left",w:"140px"},{name:"speed",textAlign:"center",w:"100px"},{name:"operation",textAlign:"right",w:"220px"}],J=e=>Math.floor(e).toString().padStart(2,"0"),et=e=>{const n=e/1e3%60,d=e/1e3/60%60,s=e/1e3/3600;return`${J(s)}:${J(d)}:${J(n)}`},tt=e=>{const n=M(),d=e.done==="undone"?"cancel":"delete",s=e.done==="done"&&e.state===I.Failed,[i,g]=F(()=>b.post(`/task/${e.type}/${d}?tid=${e.id}`)),[k,x]=F(()=>b.post(`/task/${e.type}/retry?tid=${e.id}`)),[u,m]=f(!1),p=e.name.match(e.nameAnalyzer.regex),L=p===null?e.name:e.nameAnalyzer.title(p),h=e.start_time===null?-1:new Date(e.start_time).getTime(),G=e.end_time===null?new Date().getTime():new Date(e.end_time).getTime();let O="-";const V=(o,P)=>{let v=P/o,z="bytes/s";return v>1024&&(v/=1024,z="KB/s"),v>1024&&(v/=1024,z="MB/s"),v>1024&&(v/=1024,z="GB/s"),`${v.toFixed(2)} ${z}`};if(e.done){if(e.start_time!==e.end_time&&e.progress>0&&h!==-1){const o=(G-h)/1e3,P=e.total_bytes*e.progress/100;O=V(o,P)}}else if(e.prevProgress!==void 0&&e.prevFetchTime!==void 0){const o=(e.curFetchTime-e.prevFetchTime)/1e3,P=(e.progress-e.prevProgress)*e.total_bytes/100;O=V(o,P)}return t(w,{get when(){return!u()},get children(){return[t(N,{w:"$full",p:"$2",get children(){return[t(N,{get w(){return l[0].w},spacing:"$1",get children(){return[t(Y,{"on:click":o=>{o.stopPropagation()},get checked(){return e.local.selected},onChange:o=>{e.setLocal({selected:o.target.checked,expanded:e.local.expanded})}}),t(re,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:L})]}}),t(w,{get when(){return _().role===2},get children(){return t(q,{get w(){return l[1].w},get children(){return t(Ze,{get name(){return e.creator},get role(){return e.creator_role}})}})}}),t(q,{get w(){return l[2].w},get children(){return t(Ee,{get state(){return e.state}})}}),t(Ge,{get w(){return l[3].w},trackColor:"$info3",rounded:"$full",size:"sm",get value(){return e.progress},mr:"$1",get children(){return t(Ve,{color:"$info8",rounded:"$md"})}}),t(q,{get w(){return l[1].w},get children(){return t(D,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:O})}}),t($e,{get w(){return l[5].w},gap:"$1",get children(){return[t(ye,{}),t(w,{get when(){return e.canRetry},get children(){return t(y,{size:"sm",disabled:!s,display:s?"block":"none",get loading(){return k()},onClick:async()=>{const o=await x();A(o,()=>{Z.info(n("tasks.retry")),m(!0)})},get children(){return n("tasks.retry")}})}}),t(y,{size:"sm",colorScheme:"danger",get loading(){return i()},onClick:async()=>{const o=await g();A(o,()=>{Z.success(n("global.delete_success")),m(!0)})},get children(){return n(`global.${d}`)}}),t(y,{size:"sm",colorScheme:"neutral",onClick:()=>{e.setLocal({selected:e.local.selected,expanded:!e.local.expanded})},get children(){return E(()=>!!e.local.expanded,!0)()?n("tasks.fold"):n("tasks.expand")}})]}})]}}),t(w,{get when(){return e.local.expanded},get children(){return t(W,{css:{wordBreak:"break-all",fontSize:"0.8em"},w:"$full",pl:"$2",pr:"$2",get children(){return[t(je,{templateColumns:"min-content 1fr",w:"$full",columnGap:"$4",mb:"$2",get children(){return[t(w,{when:h!==-1,get children(){return[t(S,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.time_elapsed")}}),t(S,{color:"$neutral9",get children(){return et(G-h)}})]}}),t(w,{when:p!==null,get children(){return t(xe,{get each(){return Object.entries(e.nameAnalyzer.attrs)},children:o=>[t(S,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return o[0]}}),t(S,{color:"$neutral9",get children(){return o[1](p)}})]})}}),t(S,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.status")}}),t(S,{color:"$neutral9",get children(){return e.status}}),t(w,{get when(){return e.error},get children(){return[t(S,{color:"$danger9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.err")}}),t(S,{color:"$danger9",get children(){return e.error}})]}})]}}),t(He,{})]}})}})]}})},rt=e=>{const n=M(),[d,s]=F(()=>b.get(`/task/${e.type}/${e.done}`)),[i,g]=f([]),[k,x]=f("name"),[u,m]=f(!1),p={name:(r,a)=>r.name>a.name?1:-1,creator:(r,a)=>r.creator===a.creator?r.id>a.id?1:-1:r.creator>a.creator?1:-1,state:(r,a)=>r.state===a.state?r.id>a.id?1:-1:r.state>a.state?1:-1,progress:(r,a)=>r.progress===a.progress?r.id>a.id?1:-1:r.progress<a.progress?1:-1},L=R(()=>(r,a)=>(u()?-1:1)*p[k()](r,a)),h=async()=>{const r=await s();A(r,a=>{var fe;const $=new Date().getTime(),ge={},ue={},K={},he={},me={};for(const c of i())ge[c.id]=c.curFetchTime,ue[c.id]=c.prevFetchTime,K[c.id]=c.progress,he[c.id]=c.prevProgress,me[c.id]=c.local;g((fe=a==null?void 0:a.map(c=>{var we;let Q,X;c.progress===K[c.id]?(Q=ue[c.id],X=he[c.id]):(Q=ge[c.id],X=K[c.id]);const We=(we=me[c.id])!=null?we:{selected:!1,expanded:!1};return{...c,curFetchTime:$,prevFetchTime:Q,prevProgress:X,local:We}}).sort(L()))!=null?fe:[])})};if(h(),e.done==="undone"){const r=setInterval(h,2e3);Ue(()=>clearInterval(r))}const[G,O]=F(()=>b.post(`/task/${e.type}/clear_done`)),[V,o]=F(()=>b.post(`/task/${e.type}/clear_succeeded`)),[P,v]=F(()=>b.post(`/task/${e.type}/retry_failed`)),[z,Ce]=f(""),[Se,Fe]=f(new RegExp("")),[be,ae]=f(!1);Ke(()=>{try{Fe(new RegExp(z())),ae(!1)}catch{ae(!0)}});const[le,Ae]=f(_().role!==2),H=R(()=>{const r=Se(),a=le();return $=>r.test($.name)&&(!a||$.creator===_().username)}),C=R(()=>i().filter(H())),ce=R(()=>C().map(r=>r.local.selected).every(Boolean)),Pe=R(()=>C().map(r=>r.local.selected).some(Boolean)&&!ce()),ze=r=>g(i().map(a=>(H()(a)&&(a.local.selected=r),a))),se=R(()=>C().map(r=>r.local.expanded).every(Boolean)),Re=r=>g(i().map(a=>(H()(a)&&(a.local.expanded=r),a))),oe=()=>C().filter(r=>r.local.selected).map(r=>r.id),[Te,De]=F(()=>b.post(`/task/${e.type}/retry_some`,oe())),[Le,Be]=F(()=>b.post(`/task/${e.type}/${de}_some`,oe())),ie=r=>{Object.entries(r).forEach(([a,$])=>{Z.error(`${a}: ${$}`)})},[Ie,Me]=f(1),U=20,de=e.done==="undone"?"cancel":"delete",Oe=R(()=>{const r=(Ie()-1)*U,a=r+U;return C().slice(r,a)}),B=r=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:r.textAlign}),j=r=>({cursor:"pointer",onClick:()=>{k()===r.name?m(!u()):Xe(()=>{x(r.name),m(!1)}),h()}}),Ne=r=>a=>g(i().map($=>($.id===r&&($.local=a),$)));return t(W,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[t(re,{size:"lg",get children(){return n(`tasks.${e.done}`)}}),t(N,{gap:"$2",flexWrap:"wrap",get children(){return[t(w,{get when(){return e.done==="done"},get children(){return[t(y,{colorScheme:"accent",get loading(){return d()},onClick:h,get children(){return n("global.refresh")}}),t(y,{get loading(){return P()},onClick:async()=>{const r=await v();A(r,()=>h())},get children(){return n("tasks.retry_failed")}}),t(y,{colorScheme:"danger",get loading(){return G()},onClick:async()=>{const r=await O();A(r,()=>h())},get children(){return n("global.clear")}}),t(y,{colorScheme:"success",get loading(){return V()},onClick:async()=>{const r=await o();A(r,()=>h())},get children(){return n("tasks.clear_succeeded")}})]}}),t(w,{get when(){return e.canRetry},get children(){return t(y,{colorScheme:"primary",get loading(){return Te()},onClick:async()=>{const r=await De();A(r,a=>{ie(a),h()})},get children(){return n("tasks.retry_selected")}})}}),t(y,{colorScheme:"warning",get loading(){return Le()},onClick:async()=>{const r=await Be();A(r,a=>{ie(a),h()})},get children(){return n(`tasks.${de}_selected`)}}),t(Qe,{width:"auto",get placeholder(){return n("tasks.filter")},get value(){return z()},onInput:r=>Ce(r.target.value),get invalid(){return be()}}),t(w,{get when(){return _().role===2},get children(){return t(Y,{get checked(){return le()},onChange:r=>Ae(r.target.checked),get children(){return n("tasks.show_only_mine")}})}})]}}),t(W,{w:{"@initial":"1024px","@lg":"$full"},overflowX:"auto",shadow:"$md",rounded:"$lg",spacing:"$1",p:"$1",get children(){return[t(N,{class:"title",w:"$full",p:"$2",get children(){return[t(N,{get w(){return l[0].w},spacing:"$1",get children(){return[t(Y,{get disabled(){return C().length===0},get checked(){return ce()},get indeterminate(){return Pe()},onChange:r=>ze(r.target.checked)}),t(D,T(()=>B(l[0]),()=>j(l[0]),{get children(){return n(`tasks.attr.${l[0].name}`)}}))]}}),t(w,{get when(){return _().role===2},get children(){return t(D,T({get w(){return l[1].w}},()=>B(l[1]),()=>j(l[1]),{get children(){return n(`tasks.attr.${l[1].name}`)}}))}}),t(D,T({get w(){return l[2].w}},()=>B(l[2]),()=>j(l[2]),{get children(){return n(`tasks.attr.${l[2].name}`)}})),t(D,T({get w(){return l[3].w}},()=>B(l[3]),()=>j(l[3]),{get children(){return n(`tasks.attr.${l[3].name}`)}})),t(D,T({get w(){return l[4].w}},()=>B(l[4]),{get children(){return n(`tasks.attr.${l[4].name}`)}})),t($e,{get w(){return l[5].w},gap:"$2",get children(){return[t(ye,{}),t(D,T(()=>B(l[5]),{get children(){return n(`tasks.attr.${l[5].name}`)}})),t(y,{size:"xs",colorScheme:"neutral",onClick:()=>Re(!se()),get disabled(){return C().length===0},get children(){return E(()=>!!se(),!0)()?n("tasks.fold_all"):n("tasks.expand_all")}})]}})]}}),E(()=>Oe().map(r=>t(tt,T(r,e,{get setLocal(){return Ne(r.id)}}))))]}}),t(Je,{get total(){return C().length},defaultPageSize:U,onChange:r=>{Me(r)}})]}})},ot=e=>{const n=M();return t(W,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[t(re,{size:"xl",get children(){return n(`tasks.${e.type}`)}}),t(W,{w:"$full",spacing:"$2",get children(){return t(xe,{each:["undone","done"],children:d=>t(rt,{get type(){return e.type},done:d,get canRetry(){return e.canRetry},get nameAnalyzer(){return e.nameAnalyzer}})})}})]}})},nt=ne("<a></a>"),at=ne("<p></p>"),lt=ne('<a target="_blank"></a>'),te=(e,n,d=!0)=>{const s=(e==="/"?"":e)+n,i=_().base_path==="/"?"":_().base_path,g=s.startsWith(i),[k,x]=f(!1);return g&&d?(()=>{const u=nt.cloneNode(!0);return u.$$mouseout=()=>x(!1),u.$$mouseover=()=>x(!0),ee(u,s),_e(m=>{const p=k()?"text-decoration: underline":"",L=s.slice(i.length);return m._v$=ke(u,p,m._v$),L!==m._v$2&&pe(u,"href",m._v$2=L),m},{_v$:void 0,_v$2:void 0}),u})():(()=>{const u=at.cloneNode(!0);return ee(u,s),u})()},it=()=>{const e=M(),[n,d]=f(!1);return{regex:/^download (.+) to \((.+)\)$/,title:s=>s[1],attrs:{[e("tasks.attr.offline_download.url")]:s=>(()=>{const i=lt.cloneNode(!0);return i.$$mouseout=()=>d(!1),i.$$mouseover=()=>d(!0),ee(i,()=>s[1]),_e(g=>{const k=n()?"text-decoration: underline":"",x=s[1];return g._v$3=ke(i,k,g._v$3),x!==g._v$4&&pe(i,"href",g._v$4=x),g},{_v$3:void 0,_v$4:void 0}),i})(),[e("tasks.attr.offline_download.path")]:s=>te("",s[2])}}},dt=()=>{const e=M();return{regex:/^transfer \[(.*)]\((.*\/([^\/]+))\) to \[(.+)]\((.+)\)$/,title:n=>n[3],attrs:{[e("tasks.attr.offline_download.transfer_src")]:n=>te(n[1],n[2],!1),[e("tasks.attr.offline_download.transfer_dst")]:n=>te(n[4],n[5])}}};qe(["mouseover","mouseout"]);export{ot as T,dt as a,te as b,it as g};
